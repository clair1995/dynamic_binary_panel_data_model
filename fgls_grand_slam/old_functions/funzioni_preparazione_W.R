




pulisci2=function(y)
{
  punti.oc=c("[0-0*]","[*0-0]","[15-15*]","[*15-15]","[30-30*]","[*30-30]",
             "[15-40*]","[*15-40]", "[40-15*]","[*40-15]","[0-30*]","[*0-30]",
             "[30-0*]","[*30-0]", "[*40-40]", "[40-40*]","[15-0*]","[*15-0]",
             "[0-15*]","[*0-15]","[15-30*]","[*15-30]", "[30-15*]","[*30-15]",
             "[A-40*]","[*A-40]", "[40-A*]","[*40-A]", "[40-30*]","[*40-30]",
             "[30-40*]","[*30-40]", "[40-0*]","[*40-0]","[0-40*]","[*0-40]",
             "[*1-0]", "[1-0*]", "[*0-1]", "[0-1*]", "[*1-1]","[1-1*]",
             "[*2-1]", "[2-1*]", "[*1-2]", "[1-2*]", "[*2-2]","[2-2*]",
             "[*3-2]", "[3-2*]", "[*2-3]", "[2-3*]", "[*3-3]","[3-3*]",
             "[*4-3]", "[4-3*]", "[*3-4]", "[3-4*]", "[*4-4]","[4-4*]",
             "[*5-4]", "[5-4*]", "[*4-5]", "[4-5*]", "[*5-5]","[5-5*]",
             "[*6-5]", "[6-5*]", "[*5-6]", "[5-6*]", "[*6-6]","[6-6*]",
             "[*0-2]", "[0-2*]", "[*2-0]", "[2-0*]", "[*3-0]","[3-0*]", "[*0-3]","[0-3*]",
             "[*0-4]", "[0-4*]", "[*4-0]", "[4-0*]", "[*5-0]","[5-0*]", "[*0-5]","[0-5*]",
             "[*0-6]", "[0-6*]", "[*6-0]", "[6-0*]",
             "[*1-3]", "[1-3*]", "[*3-1]", "[3-1*]", "[*4-1]","[4-1*]", "[*5-1]","[5-1*]",
             "[*6-1]", "[6-1*]", "[*1-4]", "[1-4*]", "[*1-5]","[1-5*]", "[*1-6]","[1-6*]",
             "[*2-4]", "[2-4*]", "[*2-5]", "[2-5*]", "[*2-6]","[2-6*]", "[*4-2]","[4-2*]",
             "[*5-2]", "[5-2*]", "[*6-2]", "[6-2*]",
             "[*3-5]", "[3-5*]", "[*3-6]", "[3-6*]", "[*5-3]","[5-3*]", "[*6-3]","[6-3*]",
             "[*4-6]", "[4-6*]", "[*6-4]", "[6-4*]","[*7-6]" , "[7-6*]", "[*6-7]", "[6-7*]",
             "[*7-7]" , "[7-7*]", "[*7-8]", "[7-8*]", "[*8-7]" , "[8-7*]",
             "[*8-8]" , "[8-8*]", "[*8-9]", "[8-9*]", "[*9-8]" , "[9-8*]",
             "[*9-9]" , "[9-9*]", "[*9-10]", "[9-10*]", "[*10-9]" , "[10-9*]",
             "[*10-10]" , "[10-10*]", "[*11-10]", "[11-10*]", "[*10-11]" , "[10-11*]")
  
  punti.ok=c("00-00*","*00-00","15-15*","*15-15","30-30*","*30-30",
             "15-40*","*15-40", "40-15*","*40-15","00-30*","*00-30",
             "30-00*","*30-00", "*40-40", "40-40*","15-00*","*15-00",
             "00-15*","*00-15","15-30*","*15-30", "30-15*","*30-15",
             "50-40*","*50-40", "40-50*","*40-50", "40-30*","*40-30",
             "30-40*","*30-40", "40-00*","*40-00","00-40*","*00-40",
             "*01-00", "01-00*", "*00-01", "00-01*", "*01-01","01-01*",
             "*02-01", "02-01*", "*01-02", "01-02*", "*02-02","02-02*",
             "*03-02", "03-02*", "*02-03", "02-03*", "*03-03","03-03*",
             "*04-03", "04-03*", "*03-04", "03-04*", "*04-04","04-04*",
             "*05-04", "05-04*", "*04-05", "04-05*", "*05-05","05-05*",
             "*06-05", "06-05*", "*05-06", "05-06*", "*06-06","06-06*",
             "*00-02", "00-02*", "*02-00", "02-00*", "*03-00","03-00*", "*00-03","00-03*",
             "*00-04", "00-04*", "*04-00", "04-00*", "*05-00","05-00*", "*00-05","00-05*",
             "*00-06", "00-06*", "*06-00", "06-00*",
             "*01-03", "01-03*", "*03-01", "03-01*", "*04-01","04-01*", "*05-01","05-01*",
             "*06-01", "06-01*", "*01-04", "01-04*", "*01-05","01-05*", "*01-06","01-06*",
             "*02-04", "02-04*", "*02-05", "02-05*", "*02-06","02-06*", "*04-02","04-02*",
             "*05-02", "05-02*", "*06-02", "06-02*",
             "*03-05", "03-05*", "*03-06", "03-06*", "*05-03","05-03*", "*06-03","06-03*",
             "*04-06", "04-06*", "*06-04", "06-04*", "*07-06" , "07-06*", "*06-07", "06-07*",
             "*07-07" , "07-07*", "*07-08", "07-08*", "*08-07" , "08-07*",
             "*08-08" , "08-08*", "*08-09", "08-09*", "*09-08" , "09-08*",
             "*09-09" , "09-09*", "*09-10", "09-10*", "*10-09" , "10-09*",
             "*10-10" , "10-10*", "*11-10", "11-10*", "*10-11" , "10-11*")
             
  n=length(y)
  yok=c()
  for (i in 1:n)
  {if (sum(y[i]==punti.oc)==1) yok=c(yok,y[i])
  #cat(i, y[i], substr(y[i],1,1), (substr(y[i],1,1)=="["), "\n")
  }
  
  n=length(yok)
  m=length(punti.oc)
  yokk=rep(0,length(yok))
  for (i in 1:m)
  {
    ind=which(yok==punti.oc[i])
    yokk[ind]=punti.ok[i]
  }
  ind=which(yokk!=0)
  yokkk=yokk[ind]
  return(yokkk)
}



trova_errori<-function(finale, n) {
  
  check<-NULL
  x1<-NULL
  for (i in 1:length(unique(finale$riga))) {
    X=finale[which(finale$riga==i),]
    ptA<-X$vinceA
    ptB<-X$vinceB
    check[i]<-(nrow(X)==nrow(game_set(ptA,ptB,1)))
    x1<-rbind(x1,c(i,check[i]))
    
  }
  
  x1[which(x1[,2]==0),]
  
  x<-NULL
  for (i in 1:n) {
    
    x[i]<- nrow(finale[which(finale$riga==i),])
    
  }
  b<-NULL
  g_s<-NULL
  for (i in 1:length(unique(finale$riga))) {
    
    ptA<-finale$vinceA[which(finale$riga==i)]
    ptB<-finale$vinceB[which(finale$riga==i)]
    b<-cbind(game_set(ptA, ptB, uomini=1),i)
    g_s <- rbind(g_s, b )
    
  }
  y<-NULL
  for (i in 1:n) {
    
    y[i]<- nrow(g_s[which(g_s[,7]==i),])
    
  }
  sum(y==x) #i false sono errori nei match
  
  #-> A contiene match errati nel computo totale dei punti
  #x-> il numero di punti che dovrebbero esserci
  #y-> il numero di punti che la funzione calcola-> se mancano alcuni punti ma si arriva a 3 set  ci sono punti che non vengono considerati
  
  A<-cbind(x,y)
  A<-matrix(A[which(x!=y),], ncol= 2)
  rownames(A)<-x1[which(x1[,2]==0),1]
  
  return(A)
}


errori<-function(m,n) {
  
  p0A<-m$p0A
  p1A<-m$p1A
  p0B<-m$p0B
  p1B<-m$p1B
  err<-NULL
  for (i in 1:nrow(m)) {
    
    if (p0A[i]==0 & p0B[i]==0){
      
      if((p1A[i]==15 & p1B[i]==0) || (p1A[i]==0 & p1B[i]==15)) err[i]<-0
      
    }
    
    if (p0A[i]==15 & p0B[i]==0){
      
      if((p1A[i]==15 & p1B[i]==15) || (p1A[i]==30 & p1B[i]==0)) err[i]<-0
      
    }
    
    if (p0A[i]==0 & p0B[i]==15){
      
      if((p1A[i]==15 & p1B[i]==15) || (p1A[i]==0 & p1B[i]==30)) err[i]<-0
      
    }
    
    if (p0A[i]==30 & p0B[i]==0){
      
      if((p1A[i]==40 & p1B[i]==0) || (p1A[i]==30 & p1B[i]==15)) err[i]<-0
      
    }
    
    if (p0A[i]==40 & p0B[i]==0){
      
      if((p1A[i]==0 & p1B[i]==0) || (p1A[i]==40 & p1B[i]==15)) err[i]<-0
      
    }
    
    if (p0A[i]==40 & p0B[i]==15){
      
      if((p1A[i]==0 & p1B[i]==0) || (p1A[i]==40 & p1B[i]==30)) err[i]<-0
      
    }
    
    if (p0A[i]==0 & p0B[i]==30){
      
      if((p1A[i]==0 & p1B[i]==40) || (p1A[i]==15 & p1B[i]==30)) err[i]<-0
      
    }
    
    if (p0A[i]==15 & p0B[i]==40){
      
      if((p1A[i]==0 & p1B[i]==0) || (p1A[i]==30 & p1B[i]==40)) err[i]<-0
      
    }
    
    if (p0A[i]==0 & p0B[i]==40){
      
      if((p1A[i]==0 & p1B[i]==0) || (p1A[i]==15 & p1B[i]==40)) err[i]<-0
      
    }
    
    if (p0A[i]==15 & p0B[i]==15){
      
      if((p1A[i]==30 & p1B[i]==15) || (p1A[i]==15 & p1B[i]==30)) err[i]<-0
      
    }
    
    if (p0A[i]==30 & p0B[i]==15){
      
      if((p1A[i]==40 & p1B[i]==15) || (p1A[i]==30 & p1B[i]==30)) err[i]<-0
      
    }
    
    if (p0A[i]==15 & p0B[i]==30){
      
      if((p1A[i]==30 & p1B[i]==30) || (p1A[i]==15 & p1B[i]==40)) err[i]<-0
      
    }
    
    if (p0A[i]==30 & p0B[i]==30){
      
      if((p1A[i]==40 & p1B[i]==30) || (p1A[i]==30 & p1B[i]==40)) err[i]<-0
      
    }
    
    if (p0A[i]==40 & p0B[i]==30){
      
      if((p1A[i]==0 & p1B[i]==0) || (p1A[i]==40 & p1B[i]==40)) err[i]<-0
      
    }
    
    if (p0A[i]==30 & p0B[i]==40){
      
      if((p1A[i]==0 & p1B[i]==0) || (p1A[i]==40 & p1B[i]==40)) err[i]<-0
      
    }
    
    if (p0A[i]==40 & p0B[i]==40){
      
      if((p1A[i]==50 & p1B[i]==40) || (p1A[i]==40 & p1B[i]==50)) err[i]<-0
      
    }
    
    if (p0A[i]==50 & p0B[i]==40){
      
      if((p1A[i]==0 & p1B[i]==0) || (p1A[i]==40 & p1B[i]==40)) err[i]<-0
      
    }
    
    if (p0A[i]==40 & p0B[i]==50){
      
      if((p1A[i]==0 & p1B[i]==0) || (p1A[i]==40 & p1B[i]==40)) err[i]<-0
      
    }
    
    if ( (p1A[i] %in% c(1:14) & p1B[i] %in% c(0:14)) || (p1A[i] %in% c(0:14) & p1B[i] %in% c(1:14)) ) {err[i]<-0}
    
  }
  
  if (length(err)!=nrow(m)) {err<-c(err,0) }
  conta<-c(1:nrow(m))
  return(cbind(err,conta/9, nrow(m)/9))
}



trova_errori_2<-function(df, finale) {
  
  err<-NULL
  for (i in 1:n) {
    
    m<-puntiA_B(df[i,])
    e<-errori(m)
    err<-rbind(err,e)
    
  }
  e<-cbind( finale$p0A, finale$p0B, finale$p1A, finale$p1B, err)
  rownames(e)<- finale$riga
  e<-e[is.na(e[,"err"]),]
  return(e)
}





